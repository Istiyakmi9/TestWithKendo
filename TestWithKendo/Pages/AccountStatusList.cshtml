@page
@model TestWithKendo.Pages.AccountStatusListModel

@{
    ViewData["Title"] = "AccountStatusList";
}

<div id="tabstrip">
    <ul style="background: #9699c4;">
        @foreach (var accountClass in Model.AccountClass)
        {
            <li style="color: white; background: #afb1da !important;">CREDIT TASK GROUPS</li>
        }
    </ul>

    @foreach (var accountClass in Model.AccountClass)
    {
        var gridId = $"LoanStatusGrid_{accountClass.AccountClassId}";
        var dataJson = Json.Serialize(accountClass.LoanStatuses);
        var accountStatusList = Html.Raw(Model.LoanAccountStatusList);

        <div>
            <div id="addLoanSatus" onclick="openAddDialog(@accountClass.AccountClassId, false);" 
            style="margin-bottom: 16px; color: white; background: #afb1da !important;" class="k-button k-primary">
                Add New @accountClass.AccountClassName Status
            </div>

            <div id="@gridId" class="mb-2"></div>
            <div id="accountStatusWindow"></div>

            <script>

                function onDeleteClick() {

                }

                function onEditClick() {

                }

                function openAddDialog(accountClassId, action) {
                    $("#accountStatusWindow").kendoWindow({
                        width: "600px",
                        title: (action === 'ADD' ? "Add" : "Edit") + " Loan Status",
                        visible: false,
                        modal: true,
                        actions: ["Close"],
                        content: {
                            url: "/AccountStatusMain", // Razor Page without .cshtml
                            data: { accountClassId: accountClassId, action: action },
                            type: "GET"
                        },
                        open: function () {
                            this.center();
                        },
                        refresh: function () {
                            // You can bind Kendo UI widgets here if needed
                        }
                    }).data("kendoWindow").center().open();
                }

                function openKendoDialog(title, url, width, height) {
                    $("<div />").kendoWindow({
                        title: title,
                        content: url,
                        modal: true,
                        width: width,
                        height: height,
                        visible: false,
                        close: function () {
                            this.destroy();
                        }
                    }).data("kendoWindow").center().open();
                }

                $(document).ready(function () {
                    $('#addLoanSatus').kendoButton();

                    $(function () {
                        $("#tabstrip").kendoTabStrip({
                            animation: { open: { effects: "fadeIn" } }
                        });
                    });

                    var data = @Html.Raw(Model.LoanAccountStatusList); //@Html.Raw(dataJson);

                    $("#@gridId").kendoGrid({
                        dataSource: {
                            data: data,
                            pageSize: 10
                        },
                        pageable: true,
                        sortable: true,
                        filterable: true,
                        columns: [
                            {
                                command: [
                                    { name: "customDelete", text: "Delete", click: onDeleteClick },
                                ],
                                title: "Delete",
                                width: "180px"
                            },
                            {
                                command: [
                                    { name: "customEdit", text: "Edit", click: onEditClick }
                                ],
                                title: "Edit",
                                width: "180px"
                            },
                            { field: "StatusDescription", title: "Task Group Name" },
                            { field: "StatusCode", title: "Number of Tasks" },
                            {
                                field: "IsActive",
                                title: "Execution Type",
                                template: "#= IsActive ? '✔' : '' #"
                            }
                        ]
                    });
                });
            </script>
        </div>
    }
</div>