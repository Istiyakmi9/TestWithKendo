@page
@model TestWithKendo.Pages.AccountStatusListModel

@{
    ViewData["Title"] = "AccountStatusList";
}

<div class="aa-title">
    <div>
        <h1>
            <i class="title-icon fas fa-file" aria-hidden="true"></i>
            Account Status Maintenance
            <a href="adminlist.asp" class="aa-command-button">
                <i class="aa-icon fas fa-arrow-circle-left fa-fw" title="Return to Admin Panel" aria-hidden="true">
                </i>
            </a>
        </h1>
    </div>
    <div id="aa-bank-logo-container">
        <img src="/assets/img/rpslogo.png" alt="logo" id="customer-logo-image" />
    </div>
</div>

<div id="tabstrip">
    <ul>
        @foreach (var accountClass in Model.AccountClass)
        {
            <li>@accountClass.AccountClassName</li>
        }
    </ul>

    @foreach (var accountClass in Model.AccountClass)
    {
        var gridId = $"LoanStatusGrid_{accountClass.AccountClassId}";
        var dataJson = Json.Serialize(accountClass.LoanStatuses);
        var accountStatusList = Html.Raw(Model.LoanAccountStatusList);

        <div>
            <div id="addLoanSatus" onclick="openAddDialog(@accountClass.AccountClassId, false);" class="k-button k-primary">
                Add New @accountClass.AccountClassName Status
            </div>

            <div id="@gridId" class="mb-2"></div>
            <div id="accountStatusWindow"></div>

            <script>

                function onDeleteClick() {

                }

                function onEditClick() {

                }

                function openAddDialog(accountClassId, action) {
                    $("#accountStatusWindow").kendoWindow({
                        width: "600px",
                        title: (action === 'ADD' ? "Add" : "Edit") + " Loan Status",
                        visible: false,
                        modal: true,
                        actions: ["Close"],
                        content: {
                            url: "/AccountStatusMain", // Razor Page without .cshtml
                            data: { accountClassId: accountClassId, action: action },
                            type: "GET"
                        },
                        open: function () {
                            this.center();
                        },
                        refresh: function () {
                            // You can bind Kendo UI widgets here if needed
                        }
                    }).data("kendoWindow").center().open();
                }

                function openKendoDialog(title, url, width, height) {
                    $("<div />").kendoWindow({
                        title: title,
                        content: url,
                        modal: true,
                        width: width,
                        height: height,
                        visible: false,
                        close: function () {
                            this.destroy();
                        }
                    }).data("kendoWindow").center().open();
                }

                $(document).ready(function () {
                    $('#addLoanSatus').kendoButton();

                    $(function () {
                        $("#tabstrip").kendoTabStrip({
                            animation: { open: { effects: "fadeIn" } }
                        });
                    });

                    var data = @Html.Raw(Model.LoanAccountStatusList); //@Html.Raw(dataJson);

                    $("#@gridId").kendoGrid({
                        dataSource: {
                            data: data,
                            pageSize: 10
                        },
                        pageable: true,
                        sortable: true,
                        filterable: true,
                        columns: [
                            {
                                command: [
                                    { name: "customDelete", text: "Delete", click: onDeleteClick },
                                    { name: "customEdit", text: "Edit", click: onEditClick }
                                ],
                                title: "Actions",
                                width: "180px"
                            },
                            { field: "StatusDescription", title: "Status" },
                            { field: "StatusCode", title: "Code" },
                            {
                                field: "IsActive",
                                title: "Active?",
                                template: "#= IsActive ? '✔' : '' #"
                            },
                            {
                                field: "IsDefault",
                                title: "Default?",
                                template: "#= IsDefault ? '✔' : '' #"
                            }
                        ]
                    });
                });
            </script>
        </div>
    }
</div>